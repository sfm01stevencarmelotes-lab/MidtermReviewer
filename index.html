<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SFM-CHReviewerMidTerm - PHAREZ</title>
    <style>
        :root {
            --primary: #002b36;
            --secondary: #268bd2;
            --success: #22863a;
            --danger: #cb4b16;
            --light: #fdf6e3;
            --text: #073642;
            --white: #ffffff;
        }

        body {
            font-family: system-ui, -apple-system, sans-serif;
            background-color: var(--light);
            color: var(--text);
            margin: 0;
            line-height: 1.5;
        }

        header {
            background: var(--primary);
            color: var(--white);
            padding: 1.5rem;
            text-align: center;
        }

        main {
            max-width: 800px;
            margin: 1rem auto;
            padding: 1rem;
        }

        .card {
            background: var(--white);
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .hidden { display: none !important; }

        label { display: block; margin-top: 1rem; font-weight: bold; }
        
        select, input, .btn {
            width: 100%;
            padding: 0.8rem;
            margin-top: 0.5rem;
            border: 2px solid #ccc;
            border-radius: 4px;
            font-size: 1rem;
            box-sizing: border-box;
        }

        input[readonly] { background: #eee; cursor: not-allowed; }

        .btn {
            background: var(--secondary);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            text-transform: uppercase;
            margin-top: 1rem;
        }

        .btn:hover { background: #1e6fa8; }
        .btn-danger { background: var(--danger); }
        .btn-ghost { background: #657b83; margin-top: 2rem; }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            background: #eee;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            font-weight: bold;
        }

        .option-btn {
            display: block;
            width: 100%;
            text-align: left;
            background: var(--white);
            border: 2px solid #ddd;
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.95rem;
        }

        .correct { background: var(--success) !important; color: white; border-color: var(--success); }
        .wrong { background: var(--danger) !important; color: white; border-color: var(--danger); }

        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background: var(--primary); color: white; }
        tr:nth-child(even) { background: #f9f9f9; }

        .top-rank { background: #fffde7 !important; font-weight: bold; }

        @media (max-width: 600px) {
            .quiz-header { flex-direction: column; text-align: center; gap: 0.5rem; }
        }
    </style>
</head>
<body>

<header>
    <h1>SFM-CHReviewerMidTerm</h1>
    <p>Section: PHAREZ | Full Reviewer</p>
</header>

<main>
    <!-- VIEW: LOGIN -->
    <section id="login-view" class="card">
        <h2>Student Access</h2>
        <label for="player-name">Select your Name:</label>
        <select id="player-name">
            <option value="">-- Select Student --</option>
            <option>Almario</option> <option>Amandoron</option> <option>Andres</option>
            <option>Borja</option> <option>Carmelotes</option> <option>De Guzman</option>
            <option>Del Rosario</option> <option>Florentino</option> <option>Simbajon</option>
            <option>Solidum</option> <option>Soriano</option> <option>Trespeces</option>
            <option>Trinidad</option> <option>Ureta</option> <option>Zambale</option>
        </select>

        <label for="section-fixed">Section:</label>
        <input type="text" id="section-fixed" value="PHAREZ" readonly>

        <button class="btn" onclick="startQuiz()">Start 77-Question Review</button>
        <button class="btn btn-ghost" onclick="showView('admin-login-view')">Admin View</button>
    </section>

    <!-- VIEW: QUIZ -->
    <section id="quiz-view" class="card hidden">
        <div class="quiz-header">
            <span id="progress">Question 1/77</span>
            <span id="score-live">Score: 0</span>
        </div>
        <p id="cat-label" style="color: var(--secondary); font-weight: bold; font-size: 0.8rem;"></p>
        <h2 id="question-text">Question loading...</h2>
        <div id="options-list"></div>
        <button id="next-btn" class="btn hidden" onclick="loadQuestion()">Next Question &rarr;</button>
    </section>

    <!-- VIEW: RESULTS -->
    <section id="results-view" class="card hidden">
        <h2>Review Finished!</h2>
        <p id="final-result-msg" style="font-size: 1.2rem; text-align: center; font-weight: bold;"></p>
        
        <hr>
        <h3>PHAREZ Ranking Board</h3>
        <div class="table-container">
            <table>
                <thead>
                    <tr><th>Rank</th><th>Name</th><th>Highest Score</th></tr>
                </thead>
                <tbody id="ranking-table-body"></tbody>
            </table>
        </div>
        <button class="btn" onclick="resetApp()">Back to Main Page</button>
    </section>

    <!-- VIEW: ADMIN LOGIN -->
    <section id="admin-login-view" class="card hidden">
        <h2>Admin Access</h2>
        <input type="password" id="admin-pass" placeholder="Password">
        <button class="btn" onclick="doAdminLogin()">Login</button>
        <button class="btn btn-ghost" onclick="showView('login-view')">Back</button>
    </section>

    <!-- VIEW: ADMIN PANEL -->
    <section id="admin-panel" class="card hidden">
        <h2>Admin Panel</h2>
        <button class="btn btn-danger" onclick="resetDatabase()">Clear All Records</button>
        <div class="table-container">
            <table id="logs-table">
                <thead><tr><th>Student</th><th>Score</th><th>Date</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
        <button class="btn btn-ghost" onclick="showView('login-view')">Logout</button>
    </section>
</main>

<script>
    // FULL 77 QUESTIONS DATABASE
    const database = [
        // QUIZ 1 (30 Questions)
        {q:"Acculturation", a:"Cultural exchange", cat:"Quiz 1"},
        {q:"Integration", a:"Minor culture gets cultures in a major culture", cat:"Quiz 1"},
        {q:"Assimilation", a:"completely leaves the original culture", cat:"Quiz 1"},
        {q:"Monasticism", a:"Religious way of life, devote to spiritual work, lived in isolation", cat:"Quiz 1"},
        {q:"Scholasticism", a:"Uses logic, dialectal reasoning", cat:"Quiz 1"},
        {q:"Medieval", a:"Intervening years between the ancient history of the west and the modern history of the world", cat:"Quiz 1"},
        {q:"Dark ages", a:"European history perceived decline in culture, science, historical documentations", cat:"Quiz 1"},
        {q:"Theocracy", a:"Apex of papal power", cat:"Quiz 1"},
        {q:"Gregory the Great", a:"First monk to become pope, founder of Medieval Papacy", cat:"Quiz 1"},
        {q:"Monks", a:"separate from society, dedicated to religious devotion and spiritual growth", cat:"Quiz 1"},
        {q:"Jihad", a:"Holy war, concept of Islam: military efforts", cat:"Quiz 1"},
        {q:"Patrick", a:"Apostle of Ireland, led the cultural advancement in Ireland", cat:"Quiz 1"},
        {q:"Paulician Sect", a:"Adhered to dualism, high regard to the Epistle of Apostle Paul", cat:"Quiz 1"},
        {q:"Imperialism", a:"extending nations power", cat:"Quiz 1"},
        {q:"Merovindian Dynasty", a:"First ruling family of the Franks, Germanic people, powerful in western Europe", cat:"Quiz 1"},
        {q:"The Mayor of the Palace", a:"power behind the throne in the Frankish Kingdom", cat:"Quiz 1"},
        {q:"Charlamagne", a:"Son of Pepin the short, Imperator Romanorum( Emperor of the Romans) in the west", cat:"Quiz 1"},
        {q:"Pepin the Great", a:"ended the Merovingian Dynasty, First Carolingian King", cat:"Quiz 1"},
        {q:"Donation of Constantine", a:"forgery/false, a false decretal", cat:"Quiz 1"},
        {q:"Pseudo-Isidorian/False Decretals", a:"forged canon laws", cat:"Quiz 1"},
        {q:"Primus inter pares", a:"first among equals, a title used by bishops or popes", cat:"Quiz 1"},
        {q:"Missi Dominici", a:"spies, guards of Frankish Kings", cat:"Quiz 1"},
        {q:"Anarchy", a:"chaos, society without organized authority", cat:"Quiz 1"},
        {q:"Holy Roman Empire", a:"consist of kingdoms, principalities, and cities. Political entity", cat:"Quiz 1"},
        {q:"Renaissance", a:"rebirth, gap between Middle Age and Modernity, in Italy", cat:"Quiz 1"},
        {q:"Nominal Catholicism", a:"Catholic based tradition, culture, heritage to Church doctrine", cat:"Quiz 1"},
        {q:"Haji", a:"title to a Muslim who completed hajj ( the annual pilgrimage to Mecca)", cat:"Quiz 1"},
        {q:"Charles Martels", a:"won the war at Battle of Tours", cat:"Quiz 1"},
        {q:"Venerable Bede", a:"The Father of English History", cat:"Quiz 1"},
        {q:"Merovindian", a:"set of kings, Long-haired Kings", cat:"Quiz 1"},

        // QUIZ 2 (24 Questions)
        {q:"Lay Investiture", a:"a practice where a layman( king/emperor) chose(invested) church officials: bishops, abbots", cat:"Quiz 2"},
        {q:"Innocent III", a:"Apex of Papacy", cat:"Quiz 2"},
        {q:"Feudalism", a:"land for loyalty deal, a system worked like a pyramid(King-Noble-Knights-Peasants/Serfs)", cat:"Quiz 2"},
        {q:"Great Schism", a:"the East-West Schism (Rome/West vs. Constantinople/East)", cat:"Quiz 2"},
        {q:"Weak Heirs", a:"1st factor for Carolingian downfall, not politically genius, no ability to unify the Franks", cat:"Quiz 2"},
        {q:"Germanic Concept of Inheritance", a:"a father died? His land/wealth were inherited equally by his make heirs/sons", cat:"Quiz 2"},
        {q:"The Rise of Feudalism", a:"3rd factor for carolingian downfall", cat:"Quiz 2"},
        {q:"Vassal", a:"a person pledge loyalty to higher ranking lords", cat:"Quiz 2"},
        {q:"The Vikings-Slav-Magyar Invasions", a:"masters of the sea-mass migration-horseback riders, (coupe de grace/ the final blow)", cat:"Quiz 2"},
        {q:"Otto", a:"German king, saved/restored the Holy Roman Empire", cat:"Quiz 2"},
        {q:"Simony", a:"buying/selling church offices", cat:"Quiz 2"},
        {q:"Nepotism", a:"Popes/kings giving jobs, titles, lands to relatives", cat:"Quiz 2"},
        {q:"Dictatus Papae", a:"Pope is supreme in the Church, papal power", cat:"Quiz 2"},
        {q:"Transubstantiation", a:"in the mass, bread and wine turn into actual body of Christ", cat:"Quiz 2"},
        {q:"Cluny abbot", a:"Head of the monastery in Cluney, France, reports directly to popes/kings", cat:"Quiz 2"},
        {q:"Vemus Papam", a:"“We have a Pope”, announcement follows a white smoke", cat:"Quiz 2"},
        {q:"Gregory VII/Hildebrand", a:"cleanse corruption inside the Church, wrote Dictatus Papae, Excommunicated Henry IV", cat:"Quiz 2"},
        {q:"Predestination", a:"a doctrine where God already decided who go to heaven, who go to Hell", cat:"Quiz 2"},
        {q:"Interdict", a:"All sacraments were suspended in a country", cat:"Quiz 2"},
        {q:"Cluniac Reformation", a:"Cleanses the corruption in the Church, strict following doctrines", cat:"Quiz 2"},
        {q:"Papal Infaliability", a:"popes dont have aciuntability to laws, authority to all", cat:"Quiz 2"},
        {q:"Excommunicated/Excommunication", a:"a pope excludes a person from a community/church", cat:"Quiz 2"},
        {q:"Boniface VIII", a:"lowest of papacy, one of the reason the Church was in the “Babylonian captivity of the Papacy”", cat:"Quiz 2"},
        {q:"Carolingian", a:"descendants of Charles Martel", cat:"Quiz 2"},

        // QUIZ 3 (23 Questions)
        {q:"Thomas Aquinas", a:"Angelic Doctor/Doctor Angelious, Dominican Monk, Dumb Ox(Fat, Quiet)", cat:"Quiz 3"},
        {q:"Crusades", a:"a series of religious military movements to recover the Holy Land from Muslims", cat:"Quiz 3"},
        {q:"Cathari", a:"the pure ones, the Churchs ultimate Enemy, rejected sacraments", cat:"Quiz 3"},
        {q:"Nominalism", a:"Denies universals(abstract categories: humanity)", cat:"Quiz 3"},
        {q:"Liturgy", a:"public worship, act of entire religious community", cat:"Quiz 3"},
        {q:"Aristotle", a:"Student of Plato, The Philosopher, Deductive thinking(his writings)", cat:"Quiz 3"},
        {q:"University of Paris", a:"Mother of Universities", cat:"Quiz 3"},
        {q:"Humanism", a:"intelectual movement focused on grammar, rhetoric, history, poetry, moral philosophy", cat:"Quiz 3"},
        {q:"Individualism", a:"a social/ethical philosophy that prioritizes independence, autonomy(master of your own life), rights of an individual person", cat:"Quiz 3"},
        {q:"Secularization", a:"religion loses goverment, law, education. Religion became a personal private choice", cat:"Quiz 3"},
        {q:"Mysticism", a:"Personal connection with the Divine/God", cat:"Quiz 3"},
        {q:"John Wycliffe", a:"The Morning Star of the Reformation, Doctor of Theology", cat:"Quiz 3"},
        {q:"Petrarch", a:"An Italian poet, First Modern Man, First Hummanist", cat:"Quiz 3"},
        {q:"Desiderius Erasmus", a:"The greatest Representative of the Rennaisance outside Italy", cat:"Quiz 3"},
        {q:"Babylonian Captivity of the Papacy", a:"instead of residing in Rome, the popes resided in Avignon, France", cat:"Quiz 3"},
        {q:"John Hus", a:"burned at the stake, Bohemian reformer", cat:"Quiz 3"},
        {q:"Penance", a:"a sacrament, an act of self-punishment", cat:"Quiz 3"},
        {q:"Lord’s Supper", a:"or Eucharist, consuming bread and wine(transubstantiation)", cat:"Quiz 3"},
        {q:"Unction of the Sick", a:"or Last Rites, provide spiritual health, strength, peace, courage", cat:"Quiz 3"},
        {q:"Infant Baptism", a:"baptizing infants, wash away Original sin", cat:"Quiz 3"},
        {q:"Marriage", a:"or Matrimony, union of two people, likened to a union of Christ and His Church", cat:"Quiz 3"},
        {q:"Confirmation", a:"laying of hands of Bishops, anointing with oil, sealing of the Holy Spirit", cat:"Quiz 3"},
        {q:"Mariolatry", a:"Veneration/worship of Mary", cat:"Quiz 3"}
    ];

    let player = { name: "", score: 0 };
    let quizPool = [];
    let qIdx = 0;
    let records = JSON.parse(localStorage.getItem('pharez_midterm_db')) || [];

    function showView(id) {
        document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
    }

    function resetApp() {
        document.getElementById('player-name').value = "";
        showView('login-view');
    }

    function startQuiz() {
        const name = document.getElementById('player-name').value;
        if(!name) { alert("Please select your name first."); return; }
        
        player = { name: name, score: 0, section: "PHAREZ" };
        qIdx = 0;
        // Shuffle ALL 77 questions
        quizPool = [...database].sort(() => Math.random() - 0.5);
        
        showView('quiz-view');
        loadQuestion();
    }

    function loadQuestion() {
        if(qIdx >= quizPool.length) { return endQuiz(); }

        const data = quizPool[qIdx];
        document.getElementById('next-btn').classList.add('hidden');
        document.getElementById('progress').innerText = `Question ${qIdx + 1} of ${quizPool.length}`;
        document.getElementById('score-live').innerText = `Score: ${player.score}`;
        document.getElementById('cat-label').innerText = data.cat;
        document.getElementById('question-text').innerText = `Define: "${data.q}"`;

        let options = [data.a];
        while(options.length < 4) {
            let r = database[Math.floor(Math.random()*database.length)].a;
            if(!options.includes(r)) options.push(r);
        }
        options.sort(() => Math.random() - 0.5);

        const list = document.getElementById('options-list');
        list.innerHTML = '';
        options.forEach(opt => {
            const b = document.createElement('button');
            b.className = 'option-btn';
            b.innerText = opt;
            b.onclick = () => checkAns(b, opt, data.a);
            list.appendChild(b);
        });
    }

    function checkAns(btn, selected, correct) {
        document.querySelectorAll('.option-btn').forEach(b => b.disabled = true);
        if(selected === correct) {
            btn.classList.add('correct');
            player.score++;
        } else {
            btn.classList.add('wrong');
            document.querySelectorAll('.option-btn').forEach(b => {
                if(b.innerText === correct) b.classList.add('correct');
            });
        }
        document.getElementById('next-btn').classList.remove('hidden');
        qIdx++;
    }

    function endQuiz() {
        records.push({ ...player, date: new Date().toLocaleDateString() });
        localStorage.setItem('pharez_midterm_db', JSON.stringify(records));
        
        document.getElementById('final-result-msg').innerText = `${player.name}, you scored ${player.score} out of 77!`;
        
        updateRankings();
        showView('results-view');
    }

    function updateRankings() {
        const students = ["Almario","Amandoron","Andres","Borja","Carmelotes","De Guzman","Del Rosario","Florentino","Simbajon","Solidum","Soriano","Trespeces","Trinidad","Ureta","Zambale"];
        
        let ranks = students.map(s => {
            let pScores = records.filter(r => r.name === s);
            let best = pScores.length > 0 ? Math.max(...pScores.map(ps => ps.score)) : 0;
            return { name: s, score: best };
        }).sort((a,b) => b.score - a.score);

        const body = document.getElementById('ranking-table-body');
        body.innerHTML = ranks.map((r, i) => `
            <tr class="${i === 0 && r.score > 0 ? 'top-rank' : ''}">
                <td>${i+1}</td>
                <td>${r.name}</td>
                <td>${r.score} / 77</td>
            </tr>
        `).join('');
    }

    function doAdminLogin() {
        if(document.getElementById('admin-pass').value === "admin123") {
            const body = document.querySelector('#logs-table tbody');
            body.innerHTML = records.map(r => `<tr><td>${r.name}</td><td>${r.score}</td><td>${r.date}</td></tr>`).reverse().join('');
            showView('admin-panel');
        } else { alert("Wrong Password."); }
    }

    function resetDatabase() {
        if(confirm("Are you sure you want to delete all student records?")) {
            localStorage.removeItem('pharez_midterm_db');
            records = [];
            updateRankings();
            alert("Database Cleared.");
        }
    }
</script>
</body>
</html>
